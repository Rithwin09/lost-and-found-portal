<div class="container mt-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="text-center mb-0">Admin: Administrator Management</h1>
    <a routerLink="/admin" class="btn btn-secondary">Back to Reports</a>
  </div>

  <div class="row">
    <!-- Left Column: List of Admins -->
    <div class="col-lg-7">
      <div class="card">
        <div class="card-header">
          <h3>All Administrator Accounts</h3>
        </div>
        <div class="card-body">
          <div *ngIf="admins.length > 0; else noAdmins" class="table-responsive">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Status</th>
                  <!-- New column for actions, only shown to Super Admin -->
                  <th *ngIf="isSuperAdmin">Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let admin of admins">
                  <td>{{ admin.id }}</td>
                  <td>{{ admin.name }}</td>
                  <td>{{ admin.email }}</td>
                  <td>
                    <span class="badge" [ngClass]="{'bg-success': admin.status === 'active', 'bg-warning text-dark': admin.status === 'pending'}">
                      {{ admin.status | titlecase }}
                    </span>
                  </td>
                  <!-- THIS IS THE NEW, SMART DELETE BUTTON CELL -->
                  <td *ngIf="isSuperAdmin">
                    <!-- The button is only visible if you are a super admin AND it's not your own account -->
                    <button *ngIf="admin.id !== loggedInAdminId" 
                            class="btn btn-danger btn-sm" 
                            (click)="deleteAdmin(admin.id)"
                            title="Delete this administrator account">
                      <i class="bi bi-trash-fill"></i> Delete
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <ng-template #noAdmins>
            <p class="text-center text-muted">There are no other administrator accounts.</p>
          </ng-template>
        </div>
      </div>
    </div>

    <!-- Right Column: Send Invitation Form (Only for Super Admin) -->
    <div *ngIf="isSuperAdmin" class="col-lg-5">
      <div class="card">
        <div class="card-header">
          <h3>Invite New Administrator</h3>
        </div>
        <div class="card-body">
          <form #inviteForm="ngForm" (ngSubmit)="sendInvitation()">
            <div class="mb-3">
              <label for="name" class="form-label">Full Name</label>
              <input type="text" class="form-control" id="name" name="name" [(ngModel)]="form.name" required>
            </div>
            <div class="mb-3">
              <label for="email" class="form-label">Email Address</label>
              <input type="email" class="form-control" id="email" name="email" [(ngModel)]="form.email" required>
            </div>
            <div class="form-text mb-3">An invitation email with a secure setup link will be sent to this address.</div>
            <div class="d-grid">
              <button type="submit" class="btn btn-primary" [disabled]="!inviteForm.form.valid">Send Invitation</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>